# 📋 Brother 라벨 프린터 출력 시스템 사용자 매뉴얼

## 목차
1. [소개](#소개)
2. [시스템 요구사항](#시스템-요구사항)
3. [설치 가이드](#설치-가이드)
4. [초기 설정](#초기-설정)
5. [주요 기능 사용법](#주요-기능-사용법)
6. [문제 해결](#문제-해결)
7. [자주 묻는 질문](#자주-묻는-질문)

---

## 소개

**Brother 라벨 프린터 출력 시스템**은 약국에서 처방전 데이터를 자동으로 처리하여 약품 라벨을 출력하는 통합 솔루션입니다.

### 🎯 주요 특징
- ✅ **자동 파일 감지**: ATC 서버의 처방전 파일을 실시간 감지
- ✅ **약품 정보 자동 조회**: 공공데이터 API를 통한 약품 정보 자동 수집
- ✅ **라벨 출력**: Brother QL-700 프린터로 약품 라벨 즉시 출력
- ✅ **데이터베이스 관리**: 모든 처방전 및 약품 정보 자동 저장
- ✅ **사용자 친화적 인터페이스**: 직관적인 UI로 쉬운 조작

---

## 시스템 요구사항

### 하드웨어
- **프린터**: Brother QL-700 라벨 프린터
- **메모리**: 최소 4GB RAM (8GB 권장)
- **저장공간**: 최소 500MB 여유 공간

### 소프트웨어
- **운영체제**: Windows 10/11 (32비트 또는 64비트)
- **Brother b-PAC SDK**: 버전 3.4 이상
- **Brother QL-700 드라이버**: 최신 버전
- **Node.js**: 버전 16 이상 (개발자용)

---

## 설치 가이드

### 1단계: Brother 소프트웨어 설치

1. **Brother QL-700 드라이버 설치**
   - Brother 공식 웹사이트에서 드라이버 다운로드
   - 설치 마법사를 따라 드라이버 설치
   - 프린터를 USB로 연결하고 전원 켜기

2. **Brother b-PAC SDK 설치**
   - [Brother 개발자 사이트](https://www.brother.co.jp/eng/dev/bpac/)에서 SDK 다운로드
   - b-PAC SDK 3.4 이상 버전 설치
   - 설치 후 컴퓨터 재시작

### 2단계: 애플리케이션 설치

1. **프로그램 파일 복사**
   - 제공된 프로그램 폴더를 원하는 위치에 복사
   - 예: `C:\Program Files\BrotherLabelSystem`

2. **바로가기 생성**
   - `BrotherLabelSystem.exe` 파일을 우클릭
   - "바로가기 만들기" 선택
   - 바로가기를 바탕화면으로 이동

---

## 초기 설정

### 🚀 처음 실행 시 설정

1. **프로그램 실행**
   - 바탕화면의 바로가기 더블클릭
   - 또는 설치 폴더의 `BrotherLabelSystem.exe` 실행

2. **설정 버튼 클릭** (우측 상단 회색 버튼)

3. **필수 설정 항목**

   #### 📁 ATC 서버 경로 설정
   - "폴더 선택" 버튼 클릭
   - 처방전 파일이 저장되는 폴더 선택 (기본: `C:\atc`)
   - 이 폴더에서 `Copy`로 시작하는 TXT 파일을 자동 감지합니다

   #### 🏥 약국 정보 입력
   - "약국 이름" 입력란에 약국명 입력
   - 라벨에 출력될 약국명입니다

   #### 📄 라벨 템플릿 선택
   - 드롭다운 메뉴에서 템플릿 선택
   - "미리보기" 버튼으로 템플릿 확인 가능
   - 기본 제공 템플릿:
     - `label1.lbx`: 표준 약품 라벨
     - `label2.lbx`: 상세 정보 포함 라벨

4. **저장 버튼 클릭**
   - 설정이 자동 저장되고 다음 실행 시 적용됩니다

---

## 주요 기능 사용법

### 📊 1. 처방전 조회 및 관리

#### 날짜별 처방전 조회
1. 상단의 **날짜 선택** 드롭다운 클릭
2. 원하는 날짜 선택 (최근 7일간 표시)
3. 선택한 날짜의 처방전 목록이 자동으로 표시됨

#### 처방전 상세 정보 보기
1. 처방전 목록에서 환자명 클릭
2. 하단에 해당 처방전의 약품 목록 표시
3. 각 약품의 처방 정보 확인 가능

### 🖨️ 2. 라벨 출력

#### 개별 약품 라벨 출력
1. 처방전 선택 후 약품 목록 확인
2. 출력할 약품의 **"라벨출력"** 버튼 클릭
3. 라벨 편집 창에서 정보 확인
4. **"출력"** 버튼 클릭하여 출력

#### 라벨 내용 편집
1. 라벨출력 버튼 클릭 시 편집 창 표시
2. 필요한 경우 내용 수정:
   - 환자명
   - 약품명
   - 복용법
   - 처방일수
3. 수정 후 "출력" 버튼 클릭

#### 프린터 선택
- 상단의 **프린터 선택** 드롭다운에서 Brother 프린터 선택
- 프로그램이 자동으로 Brother 프린터를 감지합니다

### 💊 3. 약품 정보 관리

#### 약품 정보 조회
1. 약품명을 **클릭**하면 상세정보 팝업 표시
2. 약품의 모든 정보 확인 가능:
   - 제조사
   - 보관방법
   - 효능효과
   - 약효분류
   - 급여정보

#### 약품 정보 수정
1. 상단의 **"약품설정"** 버튼 클릭
2. 약품 검색:
   - 약품코드 또는 약품명으로 검색
   - 검색 결과에서 수정할 약품 선택
3. 정보 수정:
   - 약품명
   - 약품 유형 (먹는약/바르는약/기타)
   - 단위 (정/캡슐/포/mL 등)
   - 보관 용기
   - 보관 온도
4. **"저장"** 버튼 클릭

#### 미완성 약품 정보 관리
1. 약품설정 창에서 **"미완성 약품목록 보기"** 클릭
2. API 조회 실패한 약품 목록 확인
3. 각 약품의 **"자동입력"** 버튼 클릭
4. 시스템이 자동으로 API 재조회 시도

#### 자동출력 설정
- 약품 정보 수정 시 **"자동출력"** 체크박스 선택
- 체크된 약품은 처방전 파싱 시 자동으로 라벨 출력

### 📋 4. 라벨 템플릿 정보

#### 라벨정보 확인
1. 상단의 **"라벨정보"** 버튼 클릭
2. 템플릿에서 사용 가능한 필드 확인:
   - **기본 필드**: patientName, medicineName, dose 등
   - **약품 상세 필드**: dailyDose, singleDose, prescriptionDays 등
   - **처방전 필드**: hospitalName, receiptDate 등

### ⚙️ 5. 자동 처리 기능

#### 파일 자동 감지
- ATC 서버 경로의 새 파일을 실시간 감지
- `Copy`로 시작하는 TXT 파일 자동 파싱
- 파싱 완료 시 화면 자동 갱신

#### 약품 정보 자동 조회
- 새로운 약품 발견 시 자동으로 API 조회
- 조회된 정보는 데이터베이스에 자동 저장
- 다음 처방 시 저장된 정보 재사용

---

## 문제 해결

### ❌ 프린터를 찾을 수 없을 때

1. **Brother QL-700 드라이버 확인**
   - 제어판 → 장치 및 프린터
   - Brother QL-700이 표시되는지 확인
   - 없으면 드라이버 재설치

2. **프린터 연결 확인**
   - USB 케이블 연결 상태 확인
   - 프린터 전원 확인
   - 다른 USB 포트 시도

3. **b-PAC SDK 확인**
   - b-PAC SDK가 올바르게 설치되었는지 확인
   - 관리자 권한으로 프로그램 실행

### ❌ 한글이 깨져서 출력될 때

1. **템플릿 인코딩 확인**
   - Brother P-touch Editor에서 템플릿 열기
   - 텍스트 객체의 폰트가 한글 지원 폰트인지 확인

2. **시스템 언어 설정**
   - Windows 설정 → 시간 및 언어
   - 언어 → 관리 언어 설정
   - 시스템 로캘을 한국어로 설정

### ❌ 파일이 자동으로 감지되지 않을 때

1. **ATC 서버 경로 확인**
   - 설정에서 올바른 경로가 설정되었는지 확인
   - 해당 폴더에 읽기 권한이 있는지 확인

2. **파일 형식 확인**
   - 파일명이 `Copy`로 시작하는지 확인
   - 확장자가 `.txt`인지 확인
   - 파일 인코딩이 EUC-KR인지 확인

### ❌ 약품 정보가 조회되지 않을 때

1. **인터넷 연결 확인**
   - 인터넷 연결 상태 확인
   - 방화벽이 프로그램을 차단하지 않는지 확인

2. **API 서비스 상태**
   - 공공데이터 포털 서비스 상태 확인
   - API 키 유효성 확인

---

## 자주 묻는 질문

### Q1. 여러 대의 프린터를 사용할 수 있나요?
**A:** 네, 가능합니다. 상단의 프린터 선택 드롭다운에서 원하는 Brother 프린터를 선택하면 됩니다.

### Q2. 라벨 템플릿을 수정할 수 있나요?
**A:** Brother P-touch Editor 프로그램을 사용하여 템플릿(.lbx 파일)을 수정할 수 있습니다. 수정 후 templates 폴더에 저장하면 프로그램에서 사용 가능합니다.

### Q3. 과거 데이터를 볼 수 있나요?
**A:** 날짜 선택 드롭다운에서 최근 7일간의 데이터를 조회할 수 있습니다. 모든 데이터는 데이터베이스에 저장되어 있습니다.

### Q4. 약품 정보를 일괄 수정할 수 있나요?
**A:** 현재는 개별 수정만 가능합니다. 약품설정에서 하나씩 검색하여 수정해야 합니다.

### Q5. 자동출력 기능은 어떻게 작동하나요?
**A:** 약품 정보에서 "자동출력"을 체크한 약품은 처방전 파싱 시 자동으로 라벨이 출력됩니다. 주의약품이나 특별 관리가 필요한 약품에 유용합니다.

### Q6. 백업은 어떻게 하나요?
**A:** 
- **데이터베이스**: `db/pharmacy.db` 파일을 정기적으로 백업
- **원본 파일**: `originFiles` 폴더에 자동 백업됨
- **설정 파일**: `config/config.json` 파일 백업

### Q7. 프로그램이 느려질 때는 어떻게 하나요?
**A:**
1. 오래된 데이터 정리
2. 컴퓨터 재시작
3. 데이터베이스 최적화 (개발자 문의)

---

## 📞 기술 지원

### 문의처
- **이메일**: support@pharmacysystem.kr
- **전화**: 1588-XXXX
- **원격 지원**: TeamViewer를 통한 원격 지원 가능

### 업데이트 정보
- 프로그램 업데이트는 공식 웹사이트에서 확인
- 중요 업데이트 시 이메일 안내

---

## 부록

### A. 단축키
- `F5`: 화면 새로고침
- `Ctrl+P`: 선택된 약품 라벨 출력
- `Ctrl+S`: 설정 저장
- `Esc`: 팝업 창 닫기

### B. 파일 구조
```
BrotherLabelSystem/
├── BrotherLabelSystem.exe  # 실행 파일
├── config/                  # 설정 파일
│   └── config.json
├── db/                      # 데이터베이스
│   └── pharmacy.db
├── templates/               # 라벨 템플릿
│   ├── label1.lbx
│   └── label2.lbx
├── originFiles/            # 원본 파일 백업
│   └── origin_YYYYMMDD/
└── logs/                   # 로그 파일
```

### C. 데이터 형식

#### 처방전 파일 형식 (TXT)
- **파일명**: `Copy숫자-날짜시간.txt`
- **인코딩**: EUC-KR
- **구조**: JVPHEAD (환자정보) + JVMHEAD (약품정보)

#### 약품 코드 체계
- **첫 글자**: T(전문의약품) 또는 E(일반의약품)
- **나머지**: 9자리 숫자
- **예시**: T621802320, E203456789

---

## 라이선스 및 저작권

© 2025 Brother Label System. All rights reserved.

본 소프트웨어는 약국 전용 라이선스로 제공됩니다.
무단 복제 및 배포를 금지합니다.

Brother는 Brother Industries, Ltd.의 등록 상표입니다.

---

*최종 업데이트: 2025년 8월*
*버전: 1.0.0*